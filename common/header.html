<script type="text/discourse-plugin" version="0.8">
  const { iconNode } = require("discourse-common/lib/icon-library");
  const { h } = require("virtual-dom");

  api.changeWidgetSetting('home-logo', 'href', settings.pianogroove_menu_url);

  api.decorateWidget('home-logo:after', helper => {
    const showExtraInfo = helper.attrs.minimized;
    const currentUser = api.getCurrentUser();
    const mobileView = helper.widget.site.mobileView;

    const menuClickHandler = function() {
      let $navLinkContainer = $('#nav-link-container');
      if ($navLinkContainer.css('visibility') === 'visible') {
        $navLinkContainer.css('visibility', 'hidden');
      } else if ($navLinkContainer.css('visibility') === 'hidden') {
        $navLinkContainer.css('visibility', 'visible');
      }
    };

    var linkURL = "https://www.pianogroove.com/meet-the-team/";
    var linkTitle = "Teachers";

    if (currentUser) {
      linkURL = "https://www.pianogroove.com/welcome-to-pianogroove/";
      linkTitle = "Pro Dashboard";
    }

    const subMenuClickHandler = function() {
      if ($('ul.nav-link-submenu').is(':visible')) {
        $('ul.nav-link-submenu').removeAttr('style');
        $('#header-menu-toggle').removeClass('toggled');
      } else if ($('ul.nav-link-submenu').is(':hidden')) {
        $('ul.nav-link-submenu').show();
        $('#header-menu-toggle').addClass('toggled');
      }
    };

    if (!showExtraInfo) {
      return [
        helper.h('ul#nav-link-container', [
          helper.h('li.dropdown', [
            helper.h('a.nav-link.submenu', {
              href:'https://www.pianogroove.com/jazz-piano-lessons/',
              text:'Lessons'
            }),
            helper.h('button.dropdown-toggle#header-menu-toggle',
              { onclick: subMenuClickHandler },
              iconNode("chevron-down", { class: "chevron-down" })),
            helper.h('ul.nav-link-submenu', [
              helper.h('li', [
                helper.h('a.nav-submenu-link', {
                  href:'https://www.pianogroove.com/jazz-piano-lessons/',
                  text:'Jazz Piano Lessons'
                },
                helper.h('div.nav-submenu-detail', 'step-by-step lessons to master jazz theory'))
              ]),
              helper.h('li', [
                helper.h('a.nav-submenu-link', {
                  href:'https://www.pianogroove.com/blues-piano-lessons/',
                  text:'Blues Piano Lessons'
                },
                helper.h('div.nav-submenu-detail', 'learn the blues, jazz blues, funk & gospel'))
              ]),
              helper.h('li', [
                helper.h('a.nav-submenu-link', {
                  href:'https://www.pianogroove.com/bossa-nova-lessons/',
                  text:'Brazilian Piano Lessons'
                },
                helper.h('div.nav-submenu-detail', 'study bossa nova, samba & choro styles'))
              ]),
              helper.h('li', [
                helper.h('a.nav-submenu-link', {
                  href:'https://www.pianogroove.com/jazz-piano-lessons/',
                  text:'Jazz Standard Lessons'
                },
                helper.h('div.nav-submenu-detail', 'learn to play your favourite tunes & songs'))
              ]),
              helper.h(`li.${(currentUser || mobileView) ?'hide-this':'anon-and-desktop'}`, [
                helper.h(`a.nav-submenu-link.nav-subscribe-link`, {
                  href:'https://www.pianogroove.com/join/',
                  text:'SUBSCRIBE NOW'
                })
              ]),
            ])
          ]),
          helper.h('li', [
            helper.h('a.nav-link', {
              href:'https://www.pianogroove.com/syllabus/',
              text:'Syllabuses'
            })
          ]),
          helper.h('li', [
            helper.h('a.nav-link', {
              href:'https://www.pianogroove.com/resources/',
              text:'Resources'
            })
          ]),
          helper.h('li', [
            helper.h('a.nav-link', {
              href: linkURL,
              text: linkTitle
            })
          ]),
          helper.h('li', [
            helper.h('a.nav-link', {
              href:'https://www.pianogroove.com/community/',
              text:'Community'
            })
          ]),
          helper.h('li', [
          helper.h(`a.nav-link.${(currentUser || !mobileView) ?'hide-this':'anon-and-mobile'}`, {
            href:'https://pianogroove.memberful.com/auth/sign_in',
            text:'Login'
          })
          ]),
          helper.h('li', [
            helper.h(`a.nav-link.${(currentUser || !mobileView) ?'hide-this':'anon-and-mobile'}`, {
              href:'https://pianogroove.com/join/'
            }, helper.h('span', 'Get Started Now'))
          ])
        ]),
        helper.h(`div#responsive-menu.${(currentUser) ?'logged-in':'anon'}`,
          { onclick: menuClickHandler },
          [
            helper.h('span', 'Menu'),
            iconNode("bars", { class: "bars" })
          ]
        )
      ];
    }
  });

  api.decorateWidget('header-buttons:after', helper => {
    if (!api.getCurrentUser() && !helper.widget.site.mobileView) {
      return [
        helper.attach('link', {
          href: 'https://pianogroove.memberful.com/auth/sign_in',
          rawLabel: 'Login',
          className: 'btn btn-blend btn-account'
        }),
        helper.attach('link', {
          href: 'https://pianogroove.com/join/',
          rawLabel: 'Get Started Now',
          className: 'btn btn-turquoise btn-account'
        })
      ]
    }
  })
</script>
